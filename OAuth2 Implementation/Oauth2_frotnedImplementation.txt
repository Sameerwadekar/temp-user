STEP 3ï¸âƒ£ Create CustomOAuth2UserService

Purpose:
âœ” Read Google user info
âœ” Create user if not exists
âœ” Return OAuth2User

Checklist:

Extract email

Save user if new

Assign ROLE_USER

(You already implemented this âœ”)

STEP 4ï¸âƒ£ Create OAuth2AuthenticationSuccessHandler

Purpose:
âœ” Generate JWT
âœ” Redirect to frontend

Rule: NEVER return JSON here

String redirectUrl =
    "http://localhost:5173/oauth2/success?token=" + jwt;

getRedirectStrategy().sendRedirect(request, response, redirectUrl);


ğŸ“Œ This is the handoff point between backend & frontend.

STEP 5ï¸âƒ£ Keep your normal login controller
POST /auth/login


âœ” This stays
âœ” OAuth2 does not replace it

STEP 6ï¸âƒ£ Add /auth/me endpoint

Purpose:
âœ” Common endpoint for BOTH login types

@GetMapping("/auth/me")
public UserDto getCurrentUser(Authentication authentication) {
    String email = authentication.getName();
    User user = userRepository.findByEmail(email).orElseThrow();
    return modelMapper.map(user, UserDto.class);
}

STEP 7ï¸âƒ£ Security configuration checklist
.requestMatchers("/oauth2/**").permitAll()
.requestMatchers("/auth/login").permitAll()
.requestMatchers("/auth/me").authenticated()


JWT filter must run for /auth/me.

âœ… PART B â€” FRONTEND (React)
STEP 8ï¸âƒ£ Add â€œLogin with Googleâ€ button

Rule: NO fetch()

<Button
  onClick={() =>
    window.location.href =
      "http://localhost:8080/oauth2/authorization/google"
  }
>
  Login with Google
</Button>


ğŸ“Œ OAuth2 = navigation, not API.

STEP 9ï¸âƒ£ Create OAuth success page

Create file:

OAuth2Success.jsx


Purpose:
âœ” Read token from URL
âœ” Fetch user
âœ” Store login state

// OAuth2Success.jsx
import { useEffect } from "react";
import { useLogin } from "./Context/LoginContext";
import { useNavigate } from "react-router-dom";

export default function OAuth2Success() {
  const { loginUser } = useLogin();
  const navigate = useNavigate();

  useEffect(() => {
    const params = new URLSearchParams(window.location.search);
    const token = params.get("token");

    if (!token) {
      navigate("/login");
      return;
    }

    // fetch user details using token
    fetch("http://localhost:8080/auth/me", {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    })
      .then(res => res.json())
      .then(user => {
        loginUser(token, user);
      });
  }, []);

  return <p>Logging you in...</p>;
}


STEP ğŸ”Ÿ Register route (MOST COMMON MISTAKE)
<Route path="/oauth2/success" element={<OAuth2Success />} />


âŒ Without this â†’ 404
âœ” With this â†’ login works